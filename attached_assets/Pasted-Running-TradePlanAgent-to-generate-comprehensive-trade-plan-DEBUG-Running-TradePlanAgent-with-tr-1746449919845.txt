Running TradePlanAgent to generate comprehensive trade plan...
DEBUG: Running TradePlanAgent with trade_cycle=True
DEBUG: TradePlanAgent class found: True
DEBUG: create_trade_plan_agent exists: True
DEBUG: Creating trade plan agent with data_provider
Loading existing trades to initialize portfolio state
Trade log file not found at /home/ec2-user/aGENtrader/trades/trade_log.jsonl
Portfolio snapshot thread started with interval 60 minutes
Portfolio Manager Agent initialized with base currency USDT
Max exposure limits: 85% total, 35% per asset
Max open trades: 10
Portfolio manager initialized successfully for trade planning
Trade plan agent initialized with risk:reward ratio 1.5
Created enhanced TradePlanAgent with config parameters: ['data_provider', 'allow_fallback_on_hold', 'risk_reward_ratio', 'portfolio_risk_per_trade', 'test_mode']
DEBUG: Created trade_plan_agent successfully: True
TradePlanAgent generating plan for BTC/USDT at 4h interval
Portfolio snapshot taken: 0 open positions, 10000.00 USDT
Generating trade plan for None decision
Using conflict score: 79.36350074589757%
Using directional confidence: 70.12622720897616%
Applying 50% position reduction for high conflict score (79.36350074589757%): 0.60 → 0.30
Portfolio state: total value=0.00, available cash=0.00, current exposure=0.00%, max=85.00%
Asset BTC exposure: current=0.00%, max=35.00%, available=35.00%
Trade plan generated for BUY BTC/USDT with position size 0.3
✅ Trade Plan Summary — BTC/USDT (4h)

- Signal:        BUY (Confidence: 70%, Directional: 70.12622720897616%)
- Entry:         94340.60
- Stop-Loss:     93397.20 (↓ -1.00%)
- Take-Profit:   95755.70 (↑ 1.50%)
- R:R Ratio:     1.50
- Portfolio Risk: 0.6%
- Position Size:  0.3000

📊 Portfolio Information:
- Total Value:    0.00
- Available Cash: 0.00
- Total Exposure: 0.0% / 85.0% max
- BTC Exposure: 0.0% / 35.0% max
- Trade Type:     swing
- Tags:          ['conflicted', 'high_conflict', 'position_reduced_50pct', 'swing']
- Valid Until:   2025-05-06T12:57:31.004358

📊 Agent Consensus:
- SentimentAnalystAgent     → UNKNOWN (85%) → "The BTC/USDT price has shown a significant upward trend over the analyzed period, starting at 84,883.71 and closing at 94,331.13, indicating a positive market sentiment. The increase in both price and trading volume, especially in the later candles, suggests strong buying interest and market confidence. However, the recent slight decrease in price indicates some volatility, but overall, the trend remains positive."
- LiquidityAnalystAgent     → UNKNOWN (80%) → "Analysis indicates bullish conditions for BTC/USDT"
- TechnicalAnalystAgent     → UNKNOWN (71%) → "Analysis indicates bearish conditions for BTC/USDT"

⚠️ HIGH CONFLICT DETECTED: 79.36350074589757% (Significant signal disagreement)
  Position size reduced by 50% for risk management (derived from conflict score)
📌 Fallback Heuristics Used:
  Stop-Loss: Yes - Default 1.0% stop-loss calculation
  Take-Profit: Yes - Risk-reward ratio based take-profit (1.5:1)

⚙️ Execution Details:
  Execution Time: 0.0008 seconds
  Plan Version: 1.0.0
  Agent Version: TradePlanAgent v0.2.0

🔍 Trade Type: swing
  Classified as swing trade with medium-term horizon (confidence: 70.12622720897616%)

💡 ⚠️ HIGH CONFLICT DETECTED (79.36350074589757%): Position size reduced by 50% due to significant signal disagreement. Cautious bullish opportunity with mixed signals with no clear consensus. Potential swing position Acceptable 1.5:1 swing opportunity. Portfolio constraints: 0.0% allocated of 85.0% max, BTC: 0.0% of 35.0% limit.

--------------------------------------------------

🔍 DETAILED CALCULATION STEPS:
Entry Price Determination:
  → Used primary method (liquidity-based or custom)
Stop Loss Determination:
  → Used fallback: Default 1.0% stop-loss calculation
Take Profit Determination:
  → Used fallback: Risk-reward ratio based take-profit (1.5:1)
Position Sizing:
  → Confidence: 70.12622720897616% (Tier: medium, Multiplier: 0.6)
  → HIGH CONFLICT HANDLING: 79.36350074589757% conflict score triggered 50% position reduction
  → Pre-conflict position: 0.6000 → Post-conflict: 0.3000
Agent Weight Distribution:
Signal Scores:
Trade plan generated successfully
Running PortfolioManagerAgent to update portfolio state...
Loading existing trades to initialize portfolio state
Trade log file not found at /home/ec2-user/aGENtrader/trades/trade_log.jsonl
Portfolio snapshot thread started with interval 60 minutes
Portfolio Manager Agent initialized with base currency USDT
Max exposure limits: 85% total, 35% per asset
Max open trades: 10
Checking open positions for SL/TP hits
Portfolio snapshot taken: 0 open positions, 10000.00 USDT
Portfolio Manager updated successfully with trade plan
Current portfolio value: 0
Exposure: 0.00%
Open positions: 0
Loading existing trades to initialize portfolio state
Portfolio snapshot taken: 0 open positions, 10000.00 USDT
Trade log file not found at /home/ec2-user/aGENtrader/trades/trade_log.jsonl
Portfolio snapshot thread started with interval 60 minutes
Portfolio Manager Agent initialized with base currency USDT
Max exposure limits: 85% total, 35% per asset
Max open trades: 10
Trade plan log saved to: logs/trade_plan_BTCUSDT_20250505_125731.json
Portfolio snapshot taken: 0 open positions, 10000.00 USDT

================================================================================
╔══════════════════════════════════════════════════════════════════════════════╗
║                            TRADE PLAN: BUY BTC/USDT                 ║
╠══════════════════════════════════════════════════════════════════════════════╣
║ Confidence: ███████████████████████████████████░░░░░░░░░░░░░░░ 70.1%      ║
║ Reasoning:                                                                 ║
Error running full decision cycle: 'list' object has no attribute 'split'
Traceback (most recent call last):
  File "/home/ec2-user/aGENtrader/tests/test_agent_individual.py", line 1103, in _run_full_cycle_test
    for word in reasoning.split():
AttributeError: 'list' object has no attribute 'split'


================================================================================
## Agent Test: All Agents (Decision Cycle) ##
Symbol: BTC/USDT, Interval: 4h
Time: 2025-05-05T12:57:23.937332, Elapsed: 7.09s
Mode: Real data, Temperature: 0.0
================================================================================
Error running test: 'result'
Traceback (most recent call last):
  File "/home/ec2-user/aGENtrader/tests/test_agent_individual.py", line 2509, in main
    harness.display_results(result)
  File "/home/ec2-user/aGENtrader/tests/test_agent_individual.py", line 1275, in display_results
    analysis = result['result']
KeyError: 'result'