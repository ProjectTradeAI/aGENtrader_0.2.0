Running full agent decision cycle test
Running FULL TRADE CYCLE TEST (All Agents + TradePlanAgent)
Will save full JSON output of trade cycle
Running full agent decision cycle test
Running TechnicalAnalystAgent...
Using agent-specific LLM config for technical_analyst: grok:grok-2-1212
XAI_API_KEY is available
LLM client initialized with: grok:grok-2-1212
Symbol parameter is a dictionary containing market data
Generated SELL signal for 94460.0 with 71% confidence: Bearish signals (83.3%) with trend strength 50/100, but price is at lower Bollinger Band, suggesting caution, confirmed by strong bearish ADX at 47.2
Decision recorded in performance tracker with ID: BTCUSDT-2025-05-05T10:12:55.901243
SELL decision for BTC/USDT @ 94460.0
Reasoning: Bearish signals (83.3%) with trend strength 50/100, but price is at lower Bollinger Band, suggesting caution, confirmed by strong bearish ADX at 47.2
TechnicalAnalystAgent Result:
Signal: SELL, Confidence: 71
Reasoning: Analysis indicates bearish conditions for BTC/USDT
----------------------------------------
Running SentimentAnalystAgent...
Grok sentiment client initialized successfully
Sentiment Analyst Agent initialized with 2 data sources
Using dynamic temperature (random between 0.6-0.9)
Using symbol from symbol parameter: BTC/USDT
No specific sentiment data provided, analyzing general market sentiment
Using dynamic temperature: 0.65
HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
Generated sentiment reasoning (full): The analysis of the OHLCV data for BTC/USDT over the 4-hour interval shows a consistent upward trend, with the closing price increasing from 84,474.69 to 94,460.00 over the period. This represents a significant gain, indicating a positive market sentiment. The volume has also increased, particularly in the latter part of the data, suggesting strong buying interest. The current price at the end of the period is at the higher end of the recent range, further supporting a positive outlook. The confidence in this assessment is high due to the clear trend and volume support.
SentimentAnalystAgent Result:
Signal: BUY, Confidence: 85
Reasoning: The analysis of the OHLCV data for BTC/USDT over the 4-hour interval shows a consistent upward trend...
----------------------------------------
Running SentimentAggregatorAgent...
Using agent-specific LLM config for sentiment_aggregator: grok:grok-2-1212
XAI_API_KEY is available
LLM client initialized with: grok:grok-2-1212
Sentiment Analyzer initialized with Grok model: grok-2-1212
Retrieved current price for BTC/USDT: 94457.29
Decision recorded in performance tracker with ID: BTCUSDT-2025-05-05T10:13:01.189163
BUY decision for BTC/USDT @ 94457.29
Reasoning: The sentiment for BTCUSDT leans bullish due to increased trading volume and institutional interest, despite mixed social sentiment. Regulatory developments add complexity but also opportunities. Overall, the market shows positive momentum.
SentimentAggregatorAgent Result:
Signal: BUY, Confidence: 75
Reasoning: Analysis indicates bullish conditions for BTC/USDT
----------------------------------------
Running LiquidityAnalystAgent...
Using agent-specific LLM config for liquidity_analyst: grok:grok-2-1212
XAI_API_KEY is available
LLM client initialized with: grok:grok-2-1212
Fetching order book data for BTC/USDT
Loaded 150 historical decisions
Decision recorded in performance tracker with ID: BTCUSDT-2025-05-05T10:13:01.288341
SELL decision for BTC/USDT @ 94456.82500000001
Reasoning: Strong selling pressure with bid/ask ratio of 0.10, strong resistance detected at 94456.83, good overall liquidity (score: 73/100). Suggested entry: 94362.37 (below resistance), stop-loss: 94456.84. Top bids: [94456.82: 1.98, 94456.81: 0.01, 94456.80: 0.00], top asks: [94456.83: 13.64, 94456.84: 0.00, 94457.29: 0.00]
LiquidityAnalystAgent Result:
Signal: SELL, Confidence: 95
Reasoning: Analysis indicates bearish conditions for BTC/USDT
----------------------------------------
Running OpenInterestAnalystAgent...
Using agent-specific LLM config for open_interest_analyst: grok:grok-2-1212
XAI_API_KEY is available
LLM client initialized with: grok:grok-2-1212
Using pre-fetched price data with 100 records
Using futures symbol: BTCUSDT (converted from BTC/USDT)
Fetching open interest data for BTCUSDT
Requesting futures open interest for symbol: BTCUSDT
Open interest params: {'symbol': 'BTCUSDT', 'period': '4h', 'limit': 30}
Trying to fetch mainnet historical open interest from /futures/data/openInterestHist
Successfully fetched 30 futures open interest records from mainnet historical open interest
Received 30 open interest records
First record sample: {'symbol': 'BTCUSDT', 'sumOpenInterest': 82509.007, 'sumOpenInterestValue': 7848793960.7890215, 'timestamp': 1746014400000}
Processing 30 open interest records
Open interest item 0: {'symbol': 'BTCUSDT', 'sumOpenInterest': 82509.007, 'sumOpenInterestValue': 7848793960.7890215, 'timestamp': 1746014400000}
Extracted OI: 82509.007, Timestamp: 1746014400000
Open interest item 1: {'symbol': 'BTCUSDT', 'sumOpenInterest': 81709.94, 'sumOpenInterestValue': 7677597243.628786, 'timestamp': 1746028800000}
Extracted OI: 81709.94, Timestamp: 1746028800000
Successfully parsed 30 open interest values out of 30 records
Loaded 150 historical decisions
Decision recorded in performance tracker with ID: BTCUSDT-2025-05-05T10:13:01.394805
NEUTRAL decision for BTC/USDT @ 94460.0
Reasoning: No significant change in open interest (-1.1%) or price (0.5%) indicates market equilibrium. Recent open interest neutral by -1.1% over the last 30 periods while price neutral 0.5%.. Recent OI changes: [-0.69%, -0.91%, 1.05%, -0.34%, -0.27%, -1.17%, -0.45%, 0.21%], price changes: [0.16%, -0.48%, 0.05%, 0.12%, -1.37%, -0.26%, 0.78%, -0.32%]
OpenInterestAnalystAgent Result:
Signal: NEUTRAL, Confidence: 65
Reasoning: Analysis indicates neutral conditions for BTC/USDT
----------------------------------------
Running FundingRateAnalystAgent...
Using agent-specific LLM config for funding_rate_analyst: grok:grok-2-1212
XAI_API_KEY is available
LLM client initialized with: grok:grok-2-1212
Decision recorded in performance tracker with ID: BTCUSDT-2025-05-05T10:13:01.592384
BUY decision for BTC/USDT @ 94457.29
Reasoning: Consistently positive and increasing funding rates (0.0036%) indicate strong long bias building with shorts paying increasing premiums. Recent funding rates: [-0.0060%, 0.0032%, -0.0015%, 0.0004%, 0.0032%, 0.0037%, -0.0024%, 0.0036%]
FundingRateAnalystAgent Result:
Signal: BUY, Confidence: 65
Reasoning: Analysis indicates bullish conditions for BTC/USDT
----------------------------------------
Running DecisionAgent with all analysis results...
2025-05-05 10:13:01,605 - decision_agent - INFO - Using agent weights: {'LiquidityAnalystAgent': 1.0, 'TechnicalAnalystAgent': 1.2, 'SentimentAnalystAgent': 0.8, 'SentimentAggregatorAgent': 0.8, 'FundingRateAnalystAgent': 0.8, 'OpenInterestAnalystAgent': 1.0}
Using agent weights: {'LiquidityAnalystAgent': 1.0, 'TechnicalAnalystAgent': 1.2, 'SentimentAnalystAgent': 0.8, 'SentimentAggregatorAgent': 0.8, 'FundingRateAnalystAgent': 0.8, 'OpenInterestAnalystAgent': 1.0}
Using agent-specific LLM config for decision_agent: grok:grok-2-1212
XAI_API_KEY is available
LLM client initialized with: grok:grok-2-1212
2025-05-05 10:13:01,605 - decision_agent - INFO - Decision Agent initialized with confidence threshold=70, allow_conflict_state=True
Decision Agent initialized with confidence threshold=70, allow_conflict_state=True
2025-05-05 10:13:01,606 - decision_agent - INFO - Making decision for BTC/USDT at 4h interval
Making decision for BTC/USDT at 4h interval
2025-05-05 10:13:01,606 - decision_agent - INFO - Using agent weights: {'LiquidityAnalystAgent': 1.0, 'TechnicalAnalystAgent': 1.2, 'SentimentAnalystAgent': 0.8, 'SentimentAggregatorAgent': 0.8, 'FundingRateAnalystAgent': 0.8, 'OpenInterestAnalystAgent': 1.0}
Using agent weights: {'LiquidityAnalystAgent': 1.0, 'TechnicalAnalystAgent': 1.2, 'SentimentAnalystAgent': 0.8, 'SentimentAggregatorAgent': 0.8, 'FundingRateAnalystAgent': 0.8, 'OpenInterestAnalystAgent': 1.0}
2025-05-05 10:13:01,606 - decision_agent - INFO - Making decision with analyses from: technical_analysis, sentiment_analysis, sentiment_aggregator_analysis, liquidity_analysis, open_interest_analysis, funding_rate_analysis
Making decision with analyses from: technical_analysis, sentiment_analysis, sentiment_aggregator_analysis, liquidity_analysis, open_interest_analysis, funding_rate_analysis
2025-05-05 10:13:01,606 - decision_agent - INFO - Attempting weighted decision from multiple analyses
Attempting weighted decision from multiple analyses
2025-05-05 10:13:01,606 - decision_agent - INFO - TechnicalAnalystAgent: SELL with confidence 71, weight 1.2, weighted score 85.2
TechnicalAnalystAgent: SELL with confidence 71, weight 1.2, weighted score 85.2
2025-05-05 10:13:01,606 - decision_agent - INFO - SentimentAnalystAgent: BUY with confidence 85, weight 0.8, weighted score 68.0
SentimentAnalystAgent: BUY with confidence 85, weight 0.8, weighted score 68.0
2025-05-05 10:13:01,606 - decision_agent - INFO - SentimentAggregatorAgent: BUY with confidence 75, weight 0.8, weighted score 60.0
SentimentAggregatorAgent: BUY with confidence 75, weight 0.8, weighted score 60.0
2025-05-05 10:13:01,606 - decision_agent - INFO - LiquidityAnalystAgent: SELL with confidence 95, weight 1.0, weighted score 95.0
LiquidityAnalystAgent: SELL with confidence 95, weight 1.0, weighted score 95.0
2025-05-05 10:13:01,606 - decision_agent - INFO - OpenInterestAnalystAgent: NEUTRAL with confidence 65, weight 1.0, weighted score 65.0
OpenInterestAnalystAgent: NEUTRAL with confidence 65, weight 1.0, weighted score 65.0
2025-05-05 10:13:01,607 - decision_agent - INFO - FundingRateAnalystAgent: BUY with confidence 65, weight 0.8, weighted score 52.0
FundingRateAnalystAgent: BUY with confidence 65, weight 0.8, weighted score 52.0
2025-05-05 10:13:01,607 - decision_agent - INFO - Signal breakdown:
Signal breakdown:
2025-05-05 10:13:01,607 - decision_agent - INFO -   BUY: 3 agents (avg 75.0%, weighted score: 180.0)
  BUY: 3 agents (avg 75.0%, weighted score: 180.0)
2025-05-05 10:13:01,607 - decision_agent - INFO -   SELL: 2 agents (avg 83.0%, weighted score: 180.2)
  SELL: 2 agents (avg 83.0%, weighted score: 180.2)
2025-05-05 10:13:01,607 - decision_agent - INFO -   HOLD: 0 agents
  HOLD: 0 agents
2025-05-05 10:13:01,607 - decision_agent - INFO -   NEUTRAL: 1 agents (avg 65.0%, weighted score: 65.0)
  NEUTRAL: 1 agents (avg 65.0%, weighted score: 65.0)
2025-05-05 10:13:01,607 - decision_agent - WARNING - Conflicting high-confidence signals: BUY: SentimentAnalystAgent (85%); SELL: LiquidityAnalystAgent (95%)
Conflicting high-confidence signals: BUY: SentimentAnalystAgent (85%); SELL: LiquidityAnalystAgent (95%)
2025-05-05 10:13:01,607 - decision_agent - WARNING - ⚠️ CONFLICTED decision due to high-confidence opposing signals
⚠️ CONFLICTED decision due to high-confidence opposing signals
2025-05-05 10:13:01,607 - decision_agent - INFO - CONFLICT DETECTED: Decision set to CONFLICTED, confidence 80
CONFLICT DETECTED: Decision set to CONFLICTED, confidence 80
ConflictLogger initialized with log path: logs/conflicted_decisions.jsonl
2025-05-05 10:13:01,608 - decision_agent - INFO - Logged CONFLICTED decision for analysis
Logged CONFLICTED decision for analysis
2025-05-05 10:13:01,608 - decision_agent - INFO - Final signal: CONFLICTED, confidence: 80.0%, directional confidence: 50.0%
Final signal: CONFLICTED, confidence: 80.0%, directional confidence: 50.0%
Running TradePlanAgent to generate comprehensive trade plan...
DEBUG: Running TradePlanAgent with trade_cycle=True
DEBUG: TradePlanAgent class found: True
DEBUG: create_trade_plan_agent exists: True
DEBUG: Creating trade plan agent with data_provider
Trade plan agent initialized with risk:reward ratio 1.5
Created enhanced TradePlanAgent with config parameters: ['data_provider']
DEBUG: Created trade_plan_agent successfully: True
TradePlanAgent generating plan for BTC/USDT at 1h interval
Generating trade plan for BUY decision with 75.0% confidence
Generating trade plan for BUY decision
Trade plan generated for BUY BTC/USDT with position size 0.6
✅ Trade Plan Summary — BTC/USDT (1h)

- Signal:        BUY (Confidence: 75%, Directional: 0%)
- Entry:         94460.00
- Stop-Loss:     93515.40 (↓ -1.00%)
- Take-Profit:   95876.90 (↑ 1.50%)
- R:R Ratio:     1.50
- Portfolio Risk: 1.2%
- Position Size:  0.6000
- Trade Type:     swing
- Tags:          ['swing']
- Valid Until:   2025-05-05T18:13:01.608504

📊 Agent Consensus:
- LiquidityAnalystAgent     → SELL (95%) → "Analysis indicates bearish conditions for BTC/USDT"
- SentimentAggregatorAgent  → BUY (75%) → "Analysis indicates bullish conditions for BTC/USDT"
- TechnicalAnalystAgent     → SELL (71%) → "Analysis indicates bearish conditions for BTC/USDT"

📌 Fallback Heuristics Used:
  Entry: Yes - Default current price used as entry
  Stop-Loss: Yes - Default 1.0% stop-loss calculation
  Take-Profit: Yes - Risk-reward ratio based take-profit (1.5:1)

⚙️ Execution Details:
  Execution Time: 0.0001 seconds
  Plan Version: 1.0.0
  Agent Version: TradePlanAgent v0.2.0

🔍 Trade Type: swing
  Classified as swing trade with medium-term horizon (confidence: 75.0%)

💡 Bullish bias developing with strong analyst consensus. Multi-day swing setup sentiment bullish. Acceptable 1.5:1 swing opportunity.

--------------------------------------------------
✅ Trade Plan Summary — BTC/USDT (1h)

- Signal:        BUY (Confidence: 75%, Directional: 0%)
- Entry:         94460.00
- Stop-Loss:     93515.40 (↓ -1.00%)
- Take-Profit:   95876.90 (↑ 1.50%)
- R:R Ratio:     1.50
- Portfolio Risk: 1.2%
- Position Size:  0.6000
- Trade Type:     swing
- Tags:          ['swing']
- Valid Until:   2025-05-05T18:13:01.608504

📊 Agent Consensus:
- LiquidityAnalystAgent     → SELL (95%) → "Analysis indicates bearish conditions for BTC/USDT"
- SentimentAggregatorAgent  → BUY (75%) → "Analysis indicates bullish conditions for BTC/USDT"
- TechnicalAnalystAgent     → SELL (71%) → "Analysis indicates bearish conditions for BTC/USDT"

📌 Fallback Heuristics Used:
  Entry: Yes - Default current price used as entry
  Stop-Loss: Yes - Default 1.0% stop-loss calculation
  Take-Profit: Yes - Risk-reward ratio based take-profit (1.5:1)

⚙️ Execution Details:
  Execution Time: 0.0001 seconds
  Plan Version: 1.0.0
  Agent Version: TradePlanAgent v0.2.0

🔍 Trade Type: swing
  Classified as swing trade with medium-term horizon (confidence: 75.0%)

💡 Bullish bias developing with strong analyst consensus. Multi-day swing setup sentiment bullish. Acceptable 1.5:1 swing opportunity.

--------------------------------------------------
Trade plan generated successfully
Trade plan log saved to: logs/trade_plan_BTCUSDT_20250505_101301.json
DEBUG: Trade plan available: True
DEBUG: Trade plan keys: ['signal', 'confidence', 'contributing_agents', 'reasoning', 'plan_version', 'agent_version', 'strategy_context', 'symbol', 'interval', 'original_signal', 'normalized_confidence', 'summary_confidence', 'conflict_score', 'conflict_flag', 'conflict_type', 'decision_consistency', 'entry_price', 'stop_loss', 'take_profit', 'position_size', 'conflict_handling_applied', 'reason_summary', 'conflicting_agents', 'risk_warning', 'valid_until', 'trade_type', 'risk_snapshot', 'fallback_plan', 'tags', 'plan_digest', 'decision_trace', 'performance', 'timestamp', 'execution_time_seconds', 'version']

================================================================================
## Agent Test: All Agents (Full Trade Cycle) ##
Symbol: BTC/USDT, Interval: 4h
Time: 2025-05-05T10:12:55.697066, Elapsed: 5.91s
Mode: Real data, Temperature: 0.0
================================================================================

Analysis Result:
Signal:     CONFLICTED
Confidence: 80%
Reasoning:  Conflicting high-confidence signals: BUY: SentimentAnalystAgent (85%); SELL: LiquidityAnalystAgent (95%)

================================================================================