Your task is to enhance the DecisionAgent and supporting logic to better handle real-world agent conflicts, improve signal resolution, and correct confidence misrepresentations.

---

### ğŸ¯ Objectives

âœ… 1. Normalize Agent Weights

- Ensure `settings.yaml` includes explicit weight entries for **all agents**:
  - `TechnicalAnalystAgent`
  - `SentimentAnalystAgent`
  - `SentimentAggregatorAgent`
  - `LiquidityAnalystAgent`
  - `OpenInterestAnalystAgent`
  - `FundingRateAnalystAgent`

âœ… Log any missing weights during startup and prevent fallback to implicit `1.0`.

---

âœ… 2. Add â€œCONFLICTEDâ€ Decision State

- If â‰¥2 agents issue opposing signals (e.g. one `BUY`, one `SELL`) with confidence â‰¥ `80`, and no consensus exceeds the configured confidence threshold:
  - Set `final_signal = "CONFLICTED"`
  - Output structured reasoning like:
    ```txt
    Conflicting high-confidence signals: BUY (TA, 78%), SELL (Liquidity, 90%)
    ```

âœ… Add `--allow_conflict_state` CLI flag (optional) to allow fallback to HOLD if disabled.

---

âœ… 3. Improve Final Confidence Calculation

- Update `DecisionAgent._calculate_confidence()` to:
  - Weight confidence by **agent weight**
  - Avoid averaging all signals blindly (e.g. HOLDs with 50% shouldnâ€™t nullify two BUYs at 90%)

âœ… Output:
- `final_signal_confidence` (of the chosen signal)
- `weighted_average_confidence`
- `conflict_score` (optional, how far apart top signals are)

---

âœ… 4. Fix â€œUNKNOWNâ€ Result Logic

- Prevent â€œUNKNOWNâ€ if:
  - Valid high-confidence signals exist
  - Conflict or HOLD state can be resolved

âœ… Add fallback:
```python
if final_signal is None:
    if has_strong_conflict:
        final_signal = "CONFLICTED"
    elif most_common_signal is not strong:
        final_signal = "HOLD"
    else:
        final_signal = most_common_signal
âœ… 5. Fix Open Interest â€œInsufficient Dataâ€

Check OpenInterestAnalystAgent:

Ensure it works with limit = 30 (which already succeeds at API level)

Prevent false-negative if â‰¥10 data points exist

Log a warning instead of blocking agent analysis

âœ… Acceptance Criteria
DecisionAgent logs â€œCONFLICTEDâ€ state clearly when appropriate

All agents use explicitly declared weights

Confidence score reflects signal strength, not average fuzziness

Final decisions are never â€œUNKNOWNâ€ when valid signals exist

OpenInterestAnalystAgent performs analysis unless data is truly missing